- if broadcast_comment.new_record?
  - url = broadcast_comments_path(broadcast_id: @broadcast)
  - method = :post
  - remote = false
- else
  - url = broadcast_comment_path(broadcast_comment, broadcast_id: @broadcast)
  - method = :patch
  - remote = true

- parent_comment_id = (broadcast_comment.broadcast_comment_id || 'root')
- broadcast_comment_id = (broadcast_comment.new_record? ? 'new' : broadcast_comment.id)

- if current_user
  = form_for broadcast_comment, url: url, method: method, remote: remote, html: { class: 'form-horizontal', id: "broadcast-comment-form-#{parent_comment_id}-#{broadcast_comment_id}" } do |f|
    - if broadcast_comment.errors.any?
      .panel.panel-danger
        .panel-heading
          %strong
            = pluralize broadcast_comment.errors.count, 'error'
            prohibited this comment from being saved
        .panel-body
          %ul
            - broadcast_comment.errors.full_messages.each do |message|
              %li= message

    = f.hidden_field :broadcast_comment_id

    .preview-container{ style: "margin-bottom: 20px;#{'border: 0;box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);' if parent_comment_id == 'root'}" }
      .preview-header
        = link_to 'Write', '#', data: { object: 'broadcast-comment-tab', action: 'write', parent_comment_id: parent_comment_id }, class: 'preview-tab active', tabindex: '-1'
        = link_to 'Preview', '#', data: { object: 'broadcast-comment-tab', action: 'preview', parent_comment_id: parent_comment_id, broadcast_comment_id: broadcast_comment_id }, class: 'preview-tab', tabindex: '-1'
      .preview-body{ style: 'min-height: 199px;' }
        %div{ data: { object: 'broadcast-comment-tab-content', action: 'write', parent_comment_id: parent_comment_id, broadcast_comment_id: broadcast_comment_id } }
          = f.text_area :description, rows: [[5, broadcast_comment.description.to_s.count("\n") + 1].max, 25].min, class: 'preview-control filedrag-container', data: { object: 'expandable-text-area dropfile-image', default_rows: 5, upload_url: upload_images_path(update: "#broadcast_comment_description_#{parent_comment_id}_#{broadcast_comment_id}", format: 'js'), fallback_url: new_image_path, log_id: "#log_#{parent_comment_id}_#{broadcast_comment_id}" }, id: "broadcast_comment_description_#{parent_comment_id}_#{broadcast_comment_id}"
          .filedrag{ id: "log_#{parent_comment_id}_#{broadcast_comment_id}", style: 'margin-bottom: 10px' }
            Drag images above to insert into comment.


          - if broadcast_comment.new_record?
            = f.submit 'Comment', class: 'btn btn-primary', data: { disable_with: 'Comment' }
            = link_to 'Cancel', '#', data: { object: 'blog-no-write-comment', parent_comment_id: parent_comment_id, broadcast_comment_id: broadcast_comment_id }
          - else
            = f.submit 'Update', class: 'btn btn-primary', data: { disable_with: 'Update Comment' }
            = link_to 'Cancel', broadcast_comment_path(broadcast_comment, broadcast_id: @broadcast), remote: true, class: 'btn btn-default'

        %div{ data: { object: 'broadcast-comment-tab-content', action: 'preview', parent_comment_id: parent_comment_id, broadcast_comment_id: broadcast_comment_id }, style: 'display:none' }

- else

  .preview-container{ style: "margin-bottom: 20px;#{'border: 0;box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);' if parent_comment_id == 'root'}" }
    .preview-header
      Login to Comment
    .preview-body{ style: 'min-height: 199px;' }
      - resource = User.new
      - resource_name = 'user'
      = form_for(resource, as: resource_name, url: session_path(resource_name, format: 'js'), html: { role: 'form' }, remote: true) do |f|
        = hidden_field_tag :source, 'blog'
        = hidden_field_tag :broadcast_id, @broadcast.to_param
        = hidden_field_tag :parent_comment_id, parent_comment_id
        = hidden_field_tag :broadcast_comment_id, broadcast_comment_id
        .form-group
          = f.label :email, class: 'sr-only'
          = f.email_field :email, autofocus: true, class: 'form-control', placeholder: 'Email'
        .form-group
          = f.label :password, class: 'sr-only'
          = f.password_field :password, class: 'form-control', placeholder: 'Password'
        .form-group
          %small.f500.forgot
            = link_to 'Forgot Password?', new_user_password_path
          .pull-right
            = f.check_box :remember_me
            = f.label :remember_me
        .form-group
          = submit_tag 'Sign In', class: 'btn btn-primary btn-block'


