- @title = 'Users'

.content-main-header2
  %h1
    = link_to 'Admin Dashboard', admin_path
    &middot;
    = link_to 'Users', users_path
    &middot;
    = @user.name

  = link_to 'Edit User', edit_user_path(@user), class: 'btn btn-xs btn-default'
  = link_to 'Delete User', @user, method: :delete, class: 'btn btn-xs btn-danger', data: { confirm: "Are you sure you want to delete User #{@user.name}?" } unless current_user == @user

- if @user.shadow_banned?
  .jumbotron
    %p.lead.text-center{ style: 'margin-bottom: 0' }
      %span.glyphicon.glyphicon-eye-close
      This user has been shadow banned.

%dl.dl-horizontal
  %dt Joined
  %dd
    = @user.created_at.strftime("%m/%d/%Y") if @user.created_at.present?

  %dt Forum Name
  %dd= @user.forum_name

  %dt Gender
  %dd= @user.gender

  %dt Age
  %dd= @user.age

  %dt Emails Enabled
  %dd
    = simple_check @user.emails_enabled

  %dt Number of Sessions
  %dd
    = @user.sign_in_count if @user.sign_in_count.present?

  %dt Most Recent Session
  %dd
    = @user.current_sign_in_at.strftime("%m/%d/%Y") if @user.current_sign_in_at.present?

  %dt Privacy Policy
  %dd
    = @user.accepted_privacy_policy_at.strftime("%m/%d/%Y") if @user.accepted_privacy_policy_at.present?

  %dt Consent
  %dd
    = @user.accepted_consent_at.strftime("%m/%d/%Y") if @user.accepted_consent_at.present?

  %dt Terms of Access
  %dd
    = @user.accepted_terms_of_access_at.strftime("%m/%d/%Y") if @user.accepted_terms_of_access_at.present?
    = simple_check @user.moderator?
  %dt Completed Surveys
  %dd
    = @user.completed_answer_sessions.count
  %dt Include in Data
  %dd
    = simple_check @user.include_in_exports
  %dt Owner
  %dd
    = simple_check @user.owner?
  %dt Moderator
  %dd
    = simple_check @user.moderator?
  %dt Community Contributor
  %dd
    = simple_check @user.community_contributor?
  %dt Can Build Surveys
  %dd
    = simple_check @user.can_build_surveys?





.container
  .content-container
    %h1
      = @user.name
    %p
      View this member's full social profile:
      %span.f500= link_to @user.forum_name, member_path(@user.forum_name), class: 'no-underline darkerer-blue'

  - if current_user.owner?
    .content-container
      %table.table.table-bordered.table-striped
        %thead
          %tr
            %th Assigned Survey
            %th Encounter
            %th Completion
            %th Locked
            %th Actions
        %tbody
          - @user.answer_sessions.includes(:survey).order("surveys.name_en", :encounter).each do |answer_session|
            %tr
              %td= answer_session.survey.name
              %td= answer_session.encounter
              %td= answer_session.percent_completed
              %td= simple_check answer_session.locked?
              %td
                - if answer_session.locked?
                  = link_to 'Unlock Survey', admin_unlock_survey_path(user_id: @user.id, answer_session_id: answer_session.id), method: :post, class: 'btn btn-primary btn-xs'

      .content-footer
        %h4 For admins:
        = render 'users/admin_view', user: @user

        - if current_user.owner?
          = link_to 'Edit User', edit_user_path(@user), class: 'btn btn-primary btn-xs'
          = link_to 'Delete User', @user, method: :delete, class: 'btn btn-xs btn-danger', data: { confirm: "Are you sure you want to delete User #{@user.name}?" } unless current_user == @user
