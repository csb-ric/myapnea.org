- @title = 'Users'

.content-main-header2
  %h1
    = link_to 'Admin Dashboard', admin_path
    &middot;
    = @title

= form_tag users_path, method: :get, class: 'form-inline', style: 'margin-bottom: 20px' do
  = text_field_tag 'search', params[:search], class: 'form-control'
  = submit_tag 'Search', class: 'btn btn-primary', name: nil
  = link_to 'Reset', users_path, class: 'btn btn-default'
  = link_to export_users_path(format: 'csv'), class: 'btn btn-default' do
    Export CSV

%button.btn.btn-default{ data: { object: 'show-todays-users' } }
  New users today:
  %span.f500= @all_users.where('created_at > ?', Time.zone.now.beginning_of_day).count
%button.btn.btn-default{ data: { object: 'show-this-weeks-users' } }
  New users this week:
  %span.f500= @all_users.where('created_at > ?', Time.zone.now.beginning_of_week(start_day = :sunday)).count
= render 'layouts/per_page', per_page: 40, object_count: @users.total_count

%table.table.table-striped
  %thead
    %tr
      %th Name
      %th Email
      = th_sort_field @order, 'users.current_sign_in_at', 'Recent Activity', extra_class: 'hidden-xs'
      = th_sort_field @order, 'users.shadow_banned', 'Shadow Banned', extra_class: 'text-center'
      %th.hidden-xs Surveys Completed
      = th_sort_field_rev @order, 'users.sign_in_count', 'Sign in Count', extra_class: 'hidden-xs'
      = th_sort_field_rev @order, 'reply_count', 'Posts', extra_class: 'hidden-xs'
      %th Actions
  - @users.each do |user|
    %tr{ id: "user-#{user.id}-container", class: "#{'todays-users' if user.created_at.today?} #{'this-weeks-users' if user.created_at > Time.zone.now.beginning_of_week(start_day = :sunday)}"}
      %td.nowrap
        = render 'forums/user_image_no_border', user: user, size: 18
        %span.hidden-xs= link_to user.name, user
      %td
        %span.hidden-xs= user.email
        %span.hidden-sm.hidden-md.hidden-lg= link_to user.email, user
      %td.nowrap.hidden-xs
        - if user.current_sign_in_at
          = time_ago_in_words user.current_sign_in_at
          ago
      %td.text-center
        - if user.shadow_banned?
          %span.glyphicon.glyphicon-eye-close.text-muted
      %td.hidden-xs
        = user.completed_answer_sessions.count
      %td.hidden-xs
        = user.sign_in_count
      %td.hidden-xs
        = user.replies.count
      %td.nowrap
        = link_to 'Edit', edit_user_path(user), class: 'btn btn-default btn-xs'
        - unless current_user == user
          = link_to 'Delete', user_path(user), method: :delete, remote: true, class: 'btn btn-xs btn-danger', data: { confirm: "Delete #{user.name}?" }

.text-center= paginate @users, theme: 'bootstrap'
