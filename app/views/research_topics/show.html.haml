.content-main-header
  .container
    %h1 Research Proposal
    %p= link_to 'Back to Research Topics', research_topics_path, class: 'no-underline'
%br
.container
  .row
    .col-sm-8
      = render 'research_topics/displays/standard', research_topic: @research_topic
      - if current_user
        - if current_user.cast_vote_for?(@research_topic)
          = render 'research_topics/interactions/already_voted', research_topic: @research_topic
        - if @research_topic.votes.count > 0
          .content-container
            = render 'research_topics/interactions/endorsement', research_topic: @research_topic
            %hr
            - @topic.posts.offset(1).each do |post|
              = render 'research_topics/comments/comment', comment: post

    .col-sm-4
      - if current_user
        - if current_user.owner? or current_user.moderator?
          .well
            Admins:
            - if @topic.status == 'approved'
              = link_to 'Update Progress', edit_research_topic_path(@research_topic), class: 'btn btn-xs btn-primary' if current_user.owner?
            - elsif @topic.status == 'pending_review'
              = link_to 'Approve Research Topic', forum_topic_path(@forum, @topic, topic: { status: 'approved' }), method: :patch, class: 'btn btn-success btn-xs'
              = link_to 'Reject Research Topic', forum_topic_path(@forum, @topic, topic: { status: 'hidden' }), method: :patch, class: 'btn btn-danger btn-xs'
            - elsif @topic.status == 'hidden'
              %span.small Currently hidden.
              = link_to 'Approve Research Topic', forum_topic_path(@forum, @topic, topic: { status: 'approved' }), method: :patch, class: 'btn btn-success btn-xs'
      - else
        = render 'home/join_the_community', referrer: 'research', message: 'Make a direct impact on the future of sleep apnea research'
      = render 'research_topics/sidebar'
