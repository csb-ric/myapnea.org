- @page_title = "Research Topics"

.content-main-header
  %h1 Research Discussion

- if current_user.owner? or current_user.moderator?
  .well
    %h4
      For admins:
      = link_to 'Update Progress', edit_research_topic_path(@research_topic), class: 'btn btn-xs btn-primary' if current_user.has_role? :owner
      = link_to 'Approve Research Topic', forum_topic_path(@forum, @topic, topic: { status: 'approved' }), method: :patch, class: 'btn btn-success btn-xs' unless @topic.status=="approved"

- if current_user.cast_vote_for?(@research_topic)
  -# Display of actual research topic
  .research-topic-container
    .research-topic-header
      .research-topic-header-details
        = image_tag @research_topic.user.photo_url, class: 'img-responsive', style: 'width: 50px; height: 50px; float: left'
        %p.text-dark6{ style: 'float: left; padding-left: 20px; padding-top: 20px;font-size: 15px;' }
          = render 'users/forum_name', user: @research_topic.user
          asked:
    .research-topic-body
      %h5.centered-text= @research_topic.text
      - if @research_topic.description.present?
        %hr
        %h5.f300= @research_topic.description
  -# Display of user's vote choice
  .content-container
    .content-body{ class: "text-white #{current_user.endorsed?(@research_topic) ? 'great-bcg' : 'danger-bcg' }" }
      %p.lead.horizontal-inset
        You've chosen to
        = current_user.endorsed?(@research_topic) ? "endorse" : "not endorse"
        this topic.
- else
  -# Display voting form
  = render 'research_topics/voting_form', research_topic: @research_topic

-# Display of comments
.row.horizontal-inset
  .col-sm-4
    - if @research_topic.votes.count > 0
      %h4
        Endorsement:
        %span.f300= "#{@research_topic.endorsement*100}%"
      .progress-meter
        %span{ data: { object: 'research-topic-meter', progress: "#{@research_topic.endorsement*100}" } }
  .col-sm-8
    - @topic.posts.offset(1).each do |post|
      = render 'research_topics/comments', comment: post
- 3.times do
  %br
