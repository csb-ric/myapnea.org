-# Set up survey indicators
%br
.survey-indicator
  %ul
    - @survey.questions.unarchived.each_with_index do |question, index|
      - answer = @answer_session.answers.where(question_id: question.id).first_or_initialize
      - if answer.locked?
        %li.locked{ data: { object: 'survey-indicator', target: "#{index}" } }
          %span.glyphicon.glyphicon-lock{ 'aria-hidden'=>'true' }
      - elsif answer.completed?
        %li.complete{ data: { object: 'survey-indicator', target: "#{index}" } } &#10003;
      - else
        %li.incomplete{ data: { object: 'survey-indicator', target: "#{index}" } }= index + 1


.content-main-header2
  %h1
    - if @encounter && @encounter.slug != 'baseline'
      = "#{@survey.name} - #{@encounter.name}"
    - else
      = @survey.name

- if @survey.description.present?
  .jumbotron.primary-blue-bcg
    %p.f300= @survey.description.html_safe
%p.f300.text-center{ style: 'margin-bottom: 30px' }
  %i.fa.fa-info-circle.primary-blue
  Your answers are automatically saved, but
  %span.f500 you must provide an answer to each question before a survey is considered complete.


.full-survey-container
  - @survey.questions.unarchived.each_with_index do |question, index|
    = render 'surveys/questions/show', question: question, answer_session: @answer_session, position: index

  -# End of Survey
  .survey-container
    .panel
      - if @answer_session.locked?
        %p.lead.centered
          You've already submitted this survey. You can compare your answers to others in the community by viewing the survey report!
        .centered
          - if @answer_session.child
            = link_to 'View Report', child_survey_report_path(@answer_session.child.id, @survey, @answer_session.encounter), class: 'btn btn-success btn-lg'
            = link_to 'Continue', next_child_answer_session_path(@answer_session), class: 'btn btn-primary btn-lg'
          - else
            = link_to 'View Report', report_survey_path(@survey, @answer_session.encounter), class: 'btn btn-success btn-lg'
            = link_to 'Continue', next_answer_session_path(@answer_session), class: 'btn btn-primary btn-lg'
      - else
        .centered{ data: { object: 'survey-submit-btn-container' } }
          .btn.btn-primary.btn-lg{ style: 'width:100%', data: { object: 'survey-submit-btn', path: submit_surveys_path, answer_session_id: @answer_session.id } } Submit Answers
        .panel-body.hidden{ data: { object: 'survey-submit-congratulations-container' } }
          %p.lead
            You've reached the end of the survey, and are already on your way to making an impact on sleep apnea research. From here, we highly recommend you continue and answer a few more questions to help us learn more about you and your experience with sleep apnea.
          %br
          .centered
            - if @answer_session.child
              = link_to 'View Report', child_survey_report_path(@answer_session.child.id, @survey, @answer_session.encounter), class: 'btn btn-success btn-lg'
              = link_to 'Continue', next_child_answer_session_path(@answer_session), class: 'btn btn-primary btn-lg'
            - else
              = link_to 'View Report', report_survey_path(@survey, @answer_session.encounter), class: 'btn btn-success btn-lg'
              = link_to 'Continue', next_answer_session_path(@answer_session), class: 'btn btn-primary btn-lg'
          %br
          %p.lead
            We also have an active community that you can
            = link_to 'join', account_path, class: 'lighter-blue', style: 'text-underline: none;'
            and begin participating in the
            = link_to 'forums.', forums_path, class: 'lighter-blue', style: 'text-underline: none;'
