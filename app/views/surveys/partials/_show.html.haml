-# Set up survey indicators
.survey-indicator
  %span#title Progress
  %ul
    - @survey.questions.each_with_index do |question, index|
      - answer = @answer_session.answers.where(question_id: question.id).first_or_initialize
      - if answer.locked?
        %li.locked{ data: { object: 'survey-indicator', target: "#{index}" } }
          %span.glyphicon.glyphicon-lock{ 'aria-hidden'=>'true' }
      - elsif answer.complete?
        %li.complete{ data: { object: 'survey-indicator', target: "#{index}" } } &#10003;
      - else
        %li.incomplete{ data: { object: 'survey-indicator', target: "#{index}" } }= index + 1

.full-survey-container{ data: { object: 'full-survey-container' } }
  .survey-container.active.survey-intro{ data: { object: 'survey-introduction' } }
    .panel.centered{ style: "padding: 20px;" }
      .question-container{ style: 'margin-bottom: 50px;' }
        %h2.f300
          Welcome to the
          %span.darker-blue
            = @survey.name
          survey!
        %p.lead
          = @survey.description.html_safe if @survey.description.present?
        %p.f300
          The
          %span.lighter-orange orange progress sidebar
          on the left side of the screen will show you how you are advancing, and easily let you jump to questions that you may have missed. Remember, you are allowed to navigate away at any time and your answers will automatically be saved, but
          %span.f500 you must provide an answer to each question before a survey is considered complete.
      .button-container
        .btn.btn-primary.next-question
          Begin Survey
        %p.text-muted.or-press-enter
          Or press ENTER
      %br
      -# Allow users to toggle off custom survey display
      #simple-survey-toggle-container
        %p#make-it-simple.small If you're having technical problems while completing a survey (often due to your browser version), we suggest you switch to the simple version.
        %p#make-it-exciting.small If you'd like to see the new, custom survey display, we suggest you switch to the new version.
        .btn-small.btn-warning{ style: 'display:inline-block; margin: 0px auto; padding: 2px 5px;', data: { object: 'simple-survey-toggle'} }
          %p.small.reset-layout Switch


  -# Expects a @survey and @answer_session variable
  -# Dynamically Loaded:
  - @survey.questions.each_with_index do |question, index|
    = render 'surveys/questions/show', question: question, answer_session: @answer_session, question_number: index

    - if false
      - if question.answer_templates.count > 0
        - answer = @answer_session.answers.where(question_id: question.id).first_or_initialize
        = render "surveys/question_templates/#{question.display_type}", question: question, answer_session: @answer_session, answer: answer, question_number: index
      - else
        - answer = @answer_session.answers.where(question_id: question.id).first_or_initialize
        = render 'surveys/question_templates/no_answer_templates', question: question, answer_session: @answer_session, answer: answer, question_number: index


  -# End of Survey
  .survey-container{ data: { object: 'survey-submit' } }
    .panel
      - if @answer_session.locked?
        %p.lead.centered
          You've already submitted this survey. You can compare your answers to others in the community by viewing the survey report!
        .centered
          - if @answer_session.child
            = link_to "View Report", child_survey_report_path(@answer_session.child.id, @survey, @answer_session.encounter), class: "btn btn-success btn-lg"
            = link_to "Continue", next_child_answer_session_path(@answer_session), class: "btn btn-primary btn-lg"
          - else
            = link_to "View Report", report_survey_path(@survey, @answer_session.encounter), class: "btn btn-success btn-lg"
            = link_to "Continue", next_answer_session_path(@answer_session), class: "btn btn-primary btn-lg"
      - else
        .centered{ data: { object: 'survey-submit-btn-container' } }
          .btn.btn-primary.btn-lg{ style: 'width:100%', data: { object: 'survey-submit-btn', path: submit_surveys_path, answer_session_id: @answer_session.id } } Submit Answers
        .panel-body.hidden{ data: { object: 'survey-submit-congratulations-container' } }
          =# image_tag 'myapnea/surveys/survey_congratulations.png', class: 'img-responsive', style: 'margin: auto'
          %p.lead
            You've reached the end of the survey, and are already on your way to making an impact on sleep apnea research. From here, we highly recommend you continue and answer a few more questions to help us learn more about you and your experience with sleep apnea.
          %br
          .centered
            - if @answer_session.child
              = link_to "View Report", child_survey_report_path(@answer_session.child.id, @survey, @answer_session.encounter), class: "btn btn-success btn-lg"
            - else
              = link_to "View Report", report_survey_path(@survey, @answer_session.encounter), class: "btn btn-success btn-lg"
            = link_to "Continue", next_answer_session_path(@answer_session), class: "btn btn-primary btn-lg"
          %br
          %p.lead
            We also have an active community that you can
            = link_to 'join', account_path, class: 'lighter-blue', style: 'text-underline: none;'
            and begin participating in the
            = link_to 'forums.', forums_path, class: 'lighter-blue', style: 'text-underline: none;'
